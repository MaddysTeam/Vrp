@model ResResource
<div>
	<!--左边 -->
	<div class="block_channel channel_normal_left">

		<!--浏览资源 -->
		<div class="block_panel blue_edge">
			<div class="panel_title nav">
				<a href="@Url.Action("Index", "Home")">首页</a> > <span>浏览资源</span>
			</div>
			<div class="body res_details">
				<div class="title filetype ">
					<div class="@Model.FileType"></div>@Model.Title
				</div>

				<div >
					<div >
						@if (Model.MediumTypePKID == ResResourceHelper.MediumVideo)
						{
							
							<embed type="application/x-mplayer2"
									 pluginspage="http://www.microsoft.com/Windows/MediaPlayer/"
									 width="100%" height="520"
									 src="@Model.ResourcePath"
									 wmode="transparent" autostart="false">
							
							

							
						}
						else if (Model.MediumTypePKID == ResResourceHelper.MediumAudio)
						{
							<embed type=application/x-mplayer2
									 src="@Model.ResourcePath"
									 width="100%" height="100"  wmode="transparent" autostart="false">
						}
						else if (Model.MediumTypePKID == ResResourceHelper.MediumImage)
						{
							<img src="@Model.ResourcePath" width="100%" />
						}
						else if (Model.MediumTypePKID == ResResourceHelper.MediumAnimation)
						{
							<embed type="application/x-shockwave-flash"
									 src="@Model.ResourcePath" width="100%" height="520"
									 pluginspage="http://www.adobe.com/go/getflashplayer" />
							<noembed>Alternative content</noembed>
						}
						else if (Model.FileExtName == ".pdf" | Model.FileExtName == ".PDF")
						{
							<embed type="application/pdf"  width="100%" height="600" src="@Model.ResourcePath"> </embed>
						}
						else
						{		
						<div class="filetype"></div><h5>@Model.Title</h5>
						}

					</div>


				</div>


				<div class="opbar">
					<div class="eval_star">
						<b>点击评分：</b>
						@for (int i = 0; i < 5; i++)
						{
							if (Model.Star > i)
							{
								<span class="runtime_star yes"></span>
							}
							else
							{
								<span class="runtime_star no"></span>
							}
						}
					</div>
					<div class="buttons">
						<button class="btn btn-lg btn-danger btn-op btn-default" id="favorite"><i class="fa fa-download"></i> 收藏</button>
					
						@if (Model.MediumTypePKID == ResResourceHelper.MediumVideo)
						{
							<a href="@Model.ResourcePath" id="localPlay" title="视频不能内嵌播放时，请选择本地播放模式">
								<button class="btn btn-lg btn-info btn-op btn-default">
									<i class="fa fa-play"></i>
									本地播放
								</button>
							</a>
							<button id="toClipboard" class="btn btn-lg btn-info btn-op btn-default" title="点击复制资源地址到剪贴板中" data-clipboard-text="@Model.ResourcePath">
								<i class="fa fa-copy"></i>
								复制地址
							</button>
						}
						else
						{
						<a href="@Model.ResourcePath" id="download">
							<button class="btn btn-lg btn-info btn-op btn-default">
								<i class="fa fa-save"></i>
								下载
							</button>
						</a>
						<button id="toClipboard" class="btn btn-lg btn-info btn-op btn-default" title="点击复制资源地址到剪贴板中" data-clipboard-text="@Request.Url.OriginalString.Replace(Request.Url.PathAndQuery, Model.ResourcePath)">
							<i class="fa fa-copy"></i>
							复制地址
						</button>
						}
					</div>
				</div>



				<div class="info">
		
					<div class="dzstyle">
						<div class="boxes">
							<div class="half left">
								<div class="des">
									<p><strong class="score">@ViewBag.avg</strong></p>
									<p>
										@for (int i = 0; i < 5; i++)
										{
											if (ViewBag.avg > i)
											{

												<img src="~/assets/img/ystar.png" />
											}
											else
											{
												<img src="~/assets/img/nstar.png" />
											}
										}
									</p>
									<p>共有 @ViewBag.count6 人参与了评价</p>
								</div>
							</div>
							<div class="half right">
								<ul class="bars">
									<li>5分 <div class="bar"><div class="val" style="width:@ViewBag.ct5%}"></div></div> @ViewBag.count5 人</li>
									<li>4分 <div class="bar"><div class="val" style="width:@ViewBag.ct4%}"></div></div> @ViewBag.count4 人</li>
									<li>3分 <div class="bar"><div class="val" style="width:@ViewBag.ct3%}"></div></div> @ViewBag.count3 人</li>
									<li>2分 <div class="bar"><div class="val" style="width:@ViewBag.ct2%}"></div></div> @ViewBag.count2 人</li>
									<li>1分 <div class="bar"><div class="val" style="width:@ViewBag.ct1%}"></div></div> @ViewBag.count1 人</li>
								</ul>
							</div>
						</div>
						<div style="clear:both;"></div>
					</div>



					<div class="board first">
						<p><span>关 键 字： @Model.Keywords </span></p>
						<p><span>资源类型： @Model.ResourceType</span><span>媒体格式： @Model.MediumType</span></p>
						<p><span>上传日期： @Model.CreatedTime.ToShortDateString()</span><span>浏览次数： @Model.ViewCount 次</span></p>

						<p><span>收藏次数： @Model.FavoriteCount</span><span>下载次数： @Model.DownCount 次</span></p>

						<p></p>
					</div>
					<div class="board">
						<p>@Model.Description</p>
						<h3>详细属性</h3>
					</div>
					<div class="board ">
						@*<p><span>资源编码： @Model.Code</span></p>*@
						<p><span>残疾类别： @Html.ShowPKID(Model.Deformity)</span><span>学　　段： @Html.ShowPKID(Model.Stage)</span></p>
						<p><span>领　　域： @Html.ShowPKID(Model.Domain)</span><span>年　　级： @Html.ShowPKID(Model.Grade)</span></p>
						<p><span>安置形式： @Html.ShowPKID(Model.LearnFrom)</span><span>学校类别： @Html.ShowPKID(Model.SchoolType)</span> </p>
						<p><span>学　　科： @Html.ShowPKID(Model.Subject)</span><span>作　　者： @Model.Author</span> </p>
						<p><span>单　　位： @Model.AuthorCompany</span><span>电子邮箱： @Model.AuthorEmail</span></p>
						<p><span>电　　话： @Model.AuthorPhone</span><span>地　　址： @Model.AuthorAddress</span></p>

					</div>
				</div>

				<div class="comment">
					<div class="comment_input">
						<h3>您的评论</h3>
						<textarea></textarea>
						<div class="comment_num">240</div>
						@if (Request.IsAuthenticated) { 
							<button type="submit" class="btn btn-op btn-info">发表评论</button>
						}
						else
						{
							<button type="button" disabled class="btn btn-op btn-info">登录后可发表评论</button>
						}
					</div>

					<div class="comment_count">
						共 <span id="comment_count">@ViewBag.CommentCount</span> 条评论
					</div>
					<div class="comment_list">
					</div>
					<div class="comment_more">
						<button id="getmore" class="btn btn-op btn-default">加载更多评论</button>
					</div>


				</div>
			</div>
		</div>

	</div>

	<!--右边 -->
	<div class="block_channel channel_normal_right">
		@Html.Partial("_relation")
		@Html.Partial("_viewcount")
		@Html.Partial("_newcomment")
	</div>
</div>
@section Plugins {
	@Scripts.Render("~/js/dot")
<script src="~/assets/plugins/zeroclipboard-2.2.0/ZeroClipboard.min.js" type="text/javascript"></script>
}
@section Scripts{
	<script id="tmpl-list" type="text/template">
		{{ for(var i = 0, l = it.length; i < l; i++){ }}
		<div class="media" data-id="{{= it[i].id }}">
			<div class="media-left">
				<img class="media-object" src="{{= it[i].photoPath}}">
			</div>
			<div class="media-body">
				<h4 class="media-heading"><span>{{= it[i].name }}</span> 发表于： {{= it[i].time }}</h4>
				{{= it[i].content }}
				{{? it[i].canDelete }}
					<br /><br />
					<a onclick="deleteComment(this)" class="btn btn-default btn-sm">删除该评论</a>

				@*@if (HttpContext.Current.Request.IsAuthenticated && ResSettings.SettingsInSession.CanbeManageComment)
				{
					<br /><br />
					<a onclick="deleteComment(this)" class="btn btn-default btn-sm">删除该评论</a>
				}*@
				{{? }}
			</div>
		</div>
		{{ } }}
	</script>

	<script type="text/javascript">
		var id = @Model.ResourceId;

		function deleteComment(tgt) {
			var b = $(tgt).parents(".media");
			var cid = b.data("id");

			b.remove();
			$.post("/Comment/Delete", {id:cid}, function(){});
		}

		var commentManager = {

			begin : 0,

			loadComment: function () {
				$.get("/Comment/List", {resid:id, begin: this.begin}, function(response) {
					var template = $('#tmpl-list').html();
					var html = doT.template(template).apply(null, [response]);
					$('.comment_list').append(html);

					commentManager.begin += response.length;
					if (response.length < 10)
						$("#getmore").prop("disabled", true);
				});
			},

			post: function() {
			},

			load: function() {

				$("textarea").keyup(function () {
					if ($(this).next().is(".comment_num")) {
						$(".comment_num").html((240 - $(this).val().length))
					}
					
				})

				$(".comment_input [type=submit]").on("click", function(){

					if($.trim($("textarea").val())==""){
						alert("请您输入评论内容!");
						return false;
					}

					$.post("/Comment/Submit",  {resid:id, content: $("textarea").val()}, function(data) {
						var template = $('#tmpl-list').html();
						var html = doT.template(template).apply(null, [[data]]);
						$('.comment_list').prepend(html);
						//alert("评论已经成功提交，等待管理员审核通过");
						$("textarea").val("");
					});
				});
	

				this.loadComment();
			}
		};

		$(function () {

			commentManager.load();

		});

	</script>

   <script type="text/javascript">

		var id = @Model.ResourceId;

		var auth = @(Request.IsAuthenticated ? 1 : 0);
		var canStar = @(Request.IsAuthenticated ? 1 : 0);

		$(function () {

			$("#favorite").on("click", function () {
				if (auth==0){
					alert("请先登录！");
					return false;
				}
				$.post("/Resource/Favorite", { id: id }, function (data, status) {
					
					alert(JSON.stringify(data.msg));
					//var aaa=JSON.stringify(data.state);
				
					//if (aaa="ok"){
						
					//	alertify.success(JSON.stringify(data.msg));
					//}
					//else{
					//	alertify.failure(JSON.stringify(data.msg));
					//}
			
				});
			
			});


			$("#download").on("click", function () {
				if (auth==0){
					alert("请先登录！");
					return false;
				}
				$.post("/Resource/Download", { id: id }, function (data, status) { });
			});

			$("#localPlay").on("click", function(){
				window.open($(this).attr("href"));
				return false;
			});

			var clip = new ZeroClipboard( document.getElementById("toClipboard") );
			clip.on("copy", function(e) {
				alert();
				if (auth==0){
					clip.setText("请先登录！");
					alert("请先登录！");
					return false;
				}
				$.post("/Resource/Download", { id: id }, function (data, status) { });
			});



			if (canStar){
				$(".eval_star .runtime_star").hover(function () {
					$(this).prevAll().andSelf().addClass("hover_yes").removeClass("hover_no");
					$(this).nextAll().addClass("hover_no").removeClass("hover_yes");
				}, function(){
					$(".eval_star .runtime_star").removeClass("hover_yes", "hover_no");
				}).click(function () {
					$(".eval_star .runtime_star").unbind('mouseenter mouseleave');
					var star = 5 - $(this).nextAll().length;
					$.post("/Resource/Star", {id:id, value:star}, function() {
					});

				});
			}


		});
		</script>
}