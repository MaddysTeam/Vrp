@{
	Layout = "~/Views/Shared/_ZcLayout.cshtml";
	ViewBag.Title = "首页";
}
@model CroResource

<div class="row">
	<div class="col-md-9">


		<div class="div_cont fl w100">

			<div class="show">
				<div class="row">
					<div class="col-md-3">
						<h1>
							@*<div class="@Model.FileType"></div>*@
							@Model.Title
						</h1>
					</div>
					<div class="btn-group pull-right" style="margin:13px;">
						<button class="btn btn-info">
							<i class="fa fa-download"></i> 下载此文件
						</button>
						<button class="btn btn-success" id="favorite"><i class="fa fa-star-o"></i> 收藏</button>
					</div>
				</div>
				<div id="video" class="carousel slide">
				</div>

				<div class="attr cb">

					<div class="div "  style="overflow-y:hidden; overflow-x:auto; white-space: nowrap;">
						<ul >
							@foreach (var item in Model.Courses)
							{
								<li style="display:inline-block;list-style-type: none;">
									<a href="@Url.Action("ZcView","CroResource",new { id = Model.CrosourceId ,courseId = item.CourseId })"><img src="@item.CoverPath" style="width:184px; height:115px;" /></a>
								</li>
							}
						</ul>
					</div>

					<div class="div ">
						<p><span>关 键 字： @Model.Keywords </span><span>&nbsp;&nbsp;练 习 题：<button class="btn btn-danger  btn-sm">答 题</button></span></p>
						<p><span>资源类型： 微课程</span><span>媒体格式： </span></p>
						<p><span>上传日期： @Model.CreatedTime.ToShortDateString()</span><span>浏览次数： @Model.ViewCount 次</span></p>
						<p><span>收藏次数： @Model.FavoriteCount</span><span>下载次数： @Model.DownCount 次</span></p>

						<p><span>教学设计：<button class="btn btn-info btn-sm">预 览</button></span><span>教学反思： <button class="btn btn-info  btn-sm">	预 览</button></span></p>
						<p></p>
	
					</div>
					<div class="div ">
						<p>@Model.Description</p>
						<h3>详细属性</h3>
					</div>
					<div class="div ">
						<p><span>学　　段： @Html.ShowPKID(Model.Stage)</span><span>年　　级： @Html.ShowPKID(Model.Grade)</span></p>
						<p><span>学　　科： @Html.ShowPKID(Model.Subject)</span><span>作　　者： @Model.Author</span> </p>
						<p><span>单　　位： @Model.AuthorCompany</span><span>电子邮箱： @Model.AuthorEmail</span></p>
						<p><span>电　　话： @Model.AuthorPhone</span><span>地　　址： @Model.AuthorAddress</span></p>

					</div>

				</div>



				<div class="review">
					<div class="comment_input">
						<h3>您的评论</h3>
						<textarea></textarea>
						<div class="img_ta_num">240</div>

						@if (Request.IsAuthenticated)
						{
							<button type="submit" class="btn btn-op btn-info">发表评论</button>
						}
						else
						{
							<button type="button" disabled class="s_btn">登录后可发表评论</button>
						}
					</div>
					<div class="review_page">

						<span>共 <span id="comment_count">@ViewBag.CommentCount</span> 条评论</span>

					</div>
					<div class="comment_list">
					</div>
					<div class="comment_more">
						<button id="getmore" class="btn btn-op btn-default">加载更多评论</button>
					</div>



				</div>

			</div>

		</div>

	</div>
	<div class="col-md-3">
		@*@Html.Partial("../CroResource/_relation", new { FileExtName = @Model.FileExtName, mediumtypepkid = @Model.MediumTypePKID })
		@Html.Partial("../CroResource/_viewcount", new { mediumtypepkid = @Model.MediumTypePKID, FileExtName = @Model.FileExtName })

		@Html.Partial("../CroResource/_newcomment", new { mediumtypepkid = @Model.MediumTypePKID, FileExtName = @Model.FileExtName })*@


	</div>

</div>
@section Plugins {
	@Scripts.Render("~/js/dot")
}
@section Scripts{
	<script src="~/assets/plugins/ckplayer/ckplayer/ckplayer.js"></script>

	<script>
		var videoObject = {
			container: '#video',//“#”代表容器的ID，“.”或“”代表容器的class
			variable: 'player',//该属性必需设置，值等于下面的new chplayer()的对象
			//poster:'pic/wdm.jpg',//封面图片
			//video:'http://cdn.sser.shdjg.net/20180905/0bfda535-1430-4843-8726-82fe414aacd0/学生配音讲《愚公移山》.mp4'//视频地址
			video:'@ViewBag.CurrentVideoPath'
		};
		var player=new ckplayer(videoObject);
		//jwplayer("video").setup({
		//	flashplayer:"../../assets/plugins/jwplayer/jwplayer.flash.swf",
		//	file:'http://movie.ks.js.cn/flv/other/1_0.flv',
		//	width: 640,  
		//	height: 480,  
		//	controls: true ,
		//	primary: "flash",
		//	autostart:false,
		//	//image: "/f/videos/20141119/2014111922100257_80.jpg",
		//});
	</script>

	<script id="tmpl-list" type="text/template">
		{{ for(var i = 0, l = it.length; i < l; i++){ }}
		<div class="media" data-id="{{= it[i].id }}">
			<div class="review_list ba_f1">
				<img class="media-object" src="{{= it[i].photoPath}}" width="80px" height="80px">


				<div class=" text">
					<p><span>{{= it[i].name }}</span> 发表于： {{= it[i].time }}</p>

					<p>	{{= it[i].content }}</p>
					{{? it[i].canDelete }}
					<br /><br />
					<a onclick="deleteComment(this)" class="btn btn-default btn-sm">删除该评论</a>
					{{? }}
				</div>
			</div>
		</div>
		{{ } }}
	</script>

	<script type="text/javascript">

		var id = @Model.CrosourceId;


		function deleteComment(tgt) {
			var b = $(tgt).parents(".media");
			var cid = b.data("id");
			b.remove();
			$.post("/CroComment/Delete", {id:cid}, function(){});
		}

		var commentManager = {
			begin : 0,
			loadComment: function () {
				$.get("/CroComment/CroCommentList", {resid:id, begin: this.begin}, function(response) {

					var template = $('#tmpl-list').html();
					var html = doT.template(template).apply(null, [response]);
					$('.comment_list').append(html);

					commentManager.begin += response.length;
					if (response.length < 10)
						$("#getmore").prop("disabled", true);
				});
			},

			post: function() {
			},

			load: function() {

				$("textarea").keyup(function () {
					if ($(this).next().is(".img_ta_num")) {
						$(".img_ta_num").html((240 - $(this).val().length))
					}
				})

				$(".comment_input [type=submit]").on("click", function(){
					if($.trim($("textarea").val())==""){
						alert("请您输入评论内容!");
						return false;
					}

					$.post("/CroComment/Submit",  {resid:id, content: $("textarea").val()}, function(data) {
						var template = $('#tmpl-list').html();
						var html = doT.template(template).apply(null, [[data]]);
						$('.comment_list').prepend(html);
						//alert("评论已经成功提交，等待管理员审核通过");
						$("textarea").val("");
					});
				});

				this.loadComment();
			}
		};

		$(function () {


			commentManager.load();

		});

	</script>

	<script type="text/javascript">

	var id = @Model.CrosourceId;

	var auth = @(Request.IsAuthenticated ? 1 : 0);
		var canStar = @(Request.IsAuthenticated ? 1 : 0);

		$(function () {

			$("#favorite").on("click", function () {
				if (auth==0){
					alert("请先登录！");
					return false;
				}
				$.post("/CroResource/Favorite", { id: id }, function (data, status) {

					alert(JSON.stringify(data.msg));


				});

			});




			$("#download").on("click", function () {

				if (auth==0){
					alert("请先登录！");
					return false;
				}
				$.post("/CroResource/Download", { id: id }, function (data, status) {

					//alert(JSON.stringify(data.msg));


				});

			});

		});
	</script>
}