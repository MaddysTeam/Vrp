@{
	var pageTitle = ViewBag.Title = "选择作品";
}

<div class="modal-dialog" style="width:800px;">
	<div class="modal-content">
		<div class="color-line"></div>
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
			<h4 class="modal-title" id="firstModalLabel">@pageTitle</h4>
		</div>

		<div class="modal-body" style="height:500px">
			<!-- Grid -->
			<div class="table-responsive">
				<table id="bootgridResource" class="table table-striped table-hover table-dark-header">
					<thead>
						<tr>
							<th data-column-id="resId">作品编号</th>
							<th data-column-id="title">作品名称</th>
							<th data-column-id="company">学校</th>
							<th data-column-id="author">作者</th>
							<th data-column-id="subject">学科</th>
							<th data-column-id="grade">年级</th>
							<th data-column-id="commands" data-formatter="commands" data-sortable="false" data-header-Css-Class="width180">操作</th>
						</tr>
					</thead>
				</table>
			</div>
			<!-- end Grid-->
		</div>

	</div>
</div>


<script>
	var groupId = '@Model';

	function getRequest() {
		return {
			id:groupId
		};
	}

	function getGridOptions3() {
		return $.extend(true, {}, gridOptions, {

			url: '@Url.Action("ResList","EvalManage")',

			requestHandler: function (request) { return $.extend(true, request, getRequest()); },

			formatters: {
				'commands': function (column, row) {
					var id = row.id;
						if (row.isSelect) {
								return '<div class="btn-group btn-group-xs pull-right"  data-row-id="' + row.id + '">' +
									 '<button class="btn btn-warning btn-remove" data-url="@Url.Action("RemoveRes", "EvalManage")">取消分配</button>' +
									 '</div>';
						}
					else {
						return '<div class="btn-group btn-group-xs pull-right"  data-row-id="' + row.resId + '">' +
								 '<button class="btn btn-warning btn-assign" data-url="@Url.Action("AssignRes", "EvalManage")">分配</button>' +
								 '</div>';
					}
				},
			},
		});
	}

	var resourceGrid = $('#bootgridResource');
	resourceGrid.bootgrid(getGridOptions3())
	.on('loaded.rs.jquery.bootgrid', function () {
		$(resourceGrid).find('.btn-assign').on('click', function () {
			var url = $(this).data('url');
			var resId = $(this).parent().data('row-id');
			$.post(url, { id: groupId, resId: resId }, function (data) {
				resourceGrid.bootgrid('reload');
			});
		});

		$(resourceGrid).find('.btn-remove').on('click', function () {
			var url = $(this).data('url');
			var id = $(this).parent().data('row-id');
			$.post(url, { id: id }, function (data) {
				resourceGrid.bootgrid('reload');
			});
		})
	});



</script>