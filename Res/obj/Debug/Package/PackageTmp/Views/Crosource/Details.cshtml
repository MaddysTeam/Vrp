@model CroResource
@{
	ViewBag.Title = "作品详情";

	var course = ViewBag.CurrentCourse as MicroCourse;
}
<div class="col-md-10 content-wrapper">
	<div class="row">
		<div class="col-lg-4 ">
			<ul class="breadcrumb">
				<li>
					<i class="fa fa-home"></i>
					<a href="@Url.Action("Index", "Home")">首页</a>
				</li>
				<li><a href="@Url.Action("Search", "Crosource")">作品</a></li>
				<li class="active">@ViewBag.Title</li>
			</ul>
		</div>
	</div>

	<!-- main -->
	<div class="content">
		<div class="main-header">
			<h2>@ViewBag.Title</h2>
			<em>本页面查看选中作品的详细信息</em>
		</div>

		<div class="main-content">
			<!-- Details -->
			<div class="details">
				<!-- details header -->
				<div class="details-header">
					<div class="row">
						<div class="col-lg-4 col-print-4">
							<h3><strong>@Model.Title</strong></h3>
						</div>
						<div class="col-lg-8 col-print-8 text-right">
							<ul class="list-inline">
								<li>
									点击次数:
									<strong class="badge">@Model.ViewCount</strong>
								</li>
								@*<li>
									下载次数:
									<strong class="badge">@Model.DownCount</strong>
								</li>*@
								<li>
									收藏次数:
									<strong class="badge">@Model.FavoriteCount</strong>
								</li>
								<li>
									评论次数:
									<strong class="badge">@Model.CommentCount</strong>
								</li>
							</ul>
						</div>
					</div>
				</div>
				<!-- end details header -->
				<!-- details summary -->
				<div class="details-summary">
					<div class="row">
						<!-- left side, main content -->
						<div class="col-lg-9">
							<div class="row">
								<div class="col-sm-7">
									@if (course.VideoPath != null)
									{
									<div id="video"></div>
									}
									else
									{
										<img style="width:100%" height="100%" src="@course.FitCoverPath" />
									}
									@*<img class="cover-img img-frame" src="@Model.CoverPath" />*@
								</div>
								<div class="col-sm-5">
									<div class="summary">
										<p><label>微课名称</label> @course.CourseTitle</p>
										<p><label>播放次数</label> @course.PlayCount 次</p>
										<p><label>创建时间</label> @Model.CreatedTime.ToString("yyyy-MM-dd")</p>
										<p><label>关键字</label> @foreach (var item in Model.Keywords.Split(','))
										{ <span class="badge">@item</span> }</p>
										<p><label>作者</label> @Model.Author</p>
										@if (course.DesignPath != null)
										{
										  <p><label>教学设计</label><span><a href="@course.DesignPath.Replace(".doc",".html").Replace(".docx",".html")" target="_blank" class="btn btn-info btn-sm"><i class="fa fa-eye"></i> 预 览</a></span></p>
                              }
										@if (course.SummaryPath != null)
										{
											<p><label>教学反思</label><span><a href="@course.SummaryPath.Replace(".doc",".html").Replace(".docx",".html")" target="_blank" class="btn btn-info btn-sm"><i class="fa fa-eye"></i> 预 览</a></span></p>
                              }
										<p><label>审核意见</label><span id="opinion" class="@(Model.StatePKID==10353?"text-danger":"text-info")">@Model.AuditOpinion</span></p>
									</div>
									<div class="switchs">
										@Html.CheckBox("Elite", Model.EliteScore > 0, new { @class = "switch", data_label_text = "加精", data_size = "small" })
										<span></span>
										@Html.CheckBox("State", Model.StatePKID == ResResourceHelper.StateAllow, new { @class = "switch", data_label_text = "审核合格", data_size = "small" })
									</div>
									<div class="buttons">
										<a href="@Url.Action("Edit", "Crosource", new { id = Model.CrosourceId })" class="btn btn-primary btn-block"><i class="fa fa-edit"></i> 修改作品信息</a>
									</div>
								</div>
							</div> <!-- row -->
							<hr />
							<div>

								<div class="panel">
									<div class="panel-body">
										@Model.Description
									</div>
								</div>

								<div  style="overflow-y:hidden; overflow-x:auto; white-space: nowrap;">
								<div class="details-courses">
									<ul class="course-list">
										@foreach (var item in Model.Courses)
										{
											<li style="display:inline-block;list-style-type: none;">
												<a href="@Url.Action("Details","Crosource",new { id = Model.CrosourceId ,courseId = item.CourseId })"><img src="@item.FitCoverPath" style="width:184px; height:115px;" /></a>
												<div class="text-center">@item.CourseTitle</div>
											</li>
										}
									</ul>
								</div>
							</div>
							
							</div> <!-- row -->
						</div>
						<!-- end left side, main content -->
						<!-- right side, main content -->
						<div class="col-lg-3">

							<!-- widget -->
							<div class="widget">
								<div class="widget-header">
                                    <h3><i class="fa fa-paperclip"></i> 作品分类信息</h3>
								</div>

								<div class="widget-content">
									<ul class="list-group">
	
                              <li class="list-group-item">作品类型：@Model.CourseType</li>
										@if (@Model.SubjectPKID != 0)
										{
											<li class="list-group-item">学科：@Model.Subject</li>
										}
										@if (@Model.StagePKID != 0)
										{
											<li class="list-group-item">学段：@Model.Stage</li>
										}
										@if (@Model.GradePKID != 0)
										{
											<li class="list-group-item">年级：@Model.Grade</li>
										}
										@if (!string.IsNullOrEmpty(Model.Province))
										{
											<li class="list-group-item">省份：@Model.Province</li>
										}
										@if (!string.IsNullOrEmpty(Model.Province))
										{
											<li class="list-group-item">市区：@Model.Area</li>
										}
										@if (!string.IsNullOrEmpty(Model.Province))
										{
											<li class="list-group-item">学校：@Model.School</li>
										}

									</ul>
								</div>
							</div>
							<!-- end widget -->
							<!-- widget -->
							<div class="widget">
								<div class="widget-header">
									<h3><i class="fa fa-paperclip"></i> 作者信息</h3>
								</div>

								<div class="widget-content">
									<ul class="list-group">
										<li class="list-group-item">作者：@Model.Author</li>
										@if (@Model.AuthorCompany != "")
										{
											<li class="list-group-item">单位：@Model.AuthorCompany</li>
										}
										@if (@Model.AuthorEmail != "")
										{
											<li class="list-group-item">电子邮箱：@Model.AuthorEmail</li>
										}
										@if (@Model.AuthorPhone != "")
										{
											<li class="list-group-item">电话：@Model.AuthorPhone</li>
										}
										@if (@Model.AuthorAddress != "")
										{
											<li class="list-group-item">地址：@Model.AuthorAddress</li>
										}
									</ul>
								</div>
							</div>
							<!-- end widget -->
						</div>
						<!-- end right side, main content -->

					</div>
				</div>
				<!-- end details summary -->

			</div>
			<!-- Details -->

		</div>
		<!-- /main-content -->
	</div>
	<!-- /main -->
</div>


@section Css{
}
@section Plugins{
}
@section Scripts {
	<script src="~/assets/plugins/ckplayer/ckplayer/ckplayer.js"></script>
	<script src="~/assets/plugins/jwplayer/jwplayer.js"></script>
	<script type="text/javascript">
		

		// bootstrap-switch
		$("input.switch").not("[data-switch-no-init]").bootstrapSwitch().show();


		$(function () {

			var id = @Model.CrosourceId;
			var path='@course.VideoPath';
			var ua = navigator.userAgent;
			ua = ua.toLocaleLowerCase();
			//IE11 用ckplayer
			if (ua.match(/edge/) != null){
				var videoObject = {
					container: '#video',//“#”代表容器的ID，“.”或“”代表容器的class
					variable: 'player',//该属性必需设置，值等于下面的new chplayer()的对象
					poster:'@course.CoverPath',//封面图片
					video:path
				};
				var player=new ckplayer(videoObject);
			}
			else{
				var player=jwplayer("video").setup({
					flashplayer:"../../assets/plugins/jwplayer/jwplayer.flash.swf",
					file:path,
					width: 'auto',
					height: 500,
					controls: true ,
					primary: "flash",
					autostart:false,
					image: '@course.CoverPath',
				});

				player.onPlay(function(){
					$.post('@Url.Action("Play", "Crosource")',{courseId:'@course.CourseId'},function(){});
				});
			}


			$("#Elite").on("switchChange.bootstrapSwitch", function (event, state) {
				$this = $(this);

				$.post("/Crosource/Elite", { id: id, value: state }, function (data, status) {
					if (status == "success") {
						$this.bootstrapSwitch("state", data.value, true);
						alertify.success(data.msg);
					}
					else {
						$this.bootstrapSwitch("state", !state, true);
						alertify.error(ajaxErrorMessage);
					}
				});

			});

			$("#State").on("switchChange.bootstrapSwitch", function (event, state) {
				var message = state ? "审核该资源为 - 合格" : "审核该资源为 - 不合格";
				var success = state ? "资源已审核为合格。" : "课程已审核为不合格。";
				$this = $(this);

				alertify.prompt("审核意见", function (e, str) {
					if (e) {
						$.post("/Crosource/Approve", { id: id, value: state, opinion: str }, function (data, status) {
							if (status == "success") {
								$this.bootstrapSwitch("state", data.value, true);
								$("#opinion").html(str)
								alertify.success(success);
							}
							else {
								$this.bootstrapSwitch("state", !state, true);
								alertify.error(ajaxErrorMessage);
							}
						});
					} else {
						$this.bootstrapSwitch("state", !state, true);
					}
				}, message);
			});

		});
	</script>
}